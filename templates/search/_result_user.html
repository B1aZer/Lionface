{% load media friends format_results %}

<script>
$(document).on('click','.mutual_friends',function() {
        if ($(this).data('toggled')) {
            $(this).find('.mutual_friend_list').hide();
            $(this).data('toggled', false);
        }
        else {
            $(this).find('.mutual_friend_list').show();
            $(this).data('toggled', true);
        }
});
</script>

<a href="{{ user.get_absolute_url }}"><div class="user_thumbnail" style="background-image: url('/{{ user.photo.thumb_name }}'); background-size: 50px 50px; -moz-background-size: 50px 50px !important;"></div></a>

<table height="55"><tr><td>
<a href="{{ user.get_absolute_url }}">{{ user.get_full_name }}</a> <div class="username"> {{ user.username }}  </div><br/>
<span class="subtext" style="margin: 7px 0;">

{% if current_user|mutual_friends:user %} 
        <div class="mutual_friends">Mutual Friends: <span style="cursor: pointer;">{{ current_user|mutual_friends:user }}</span>
            <div class="mutual_friend_list" style="display:none">
                {% for friend in current_user|list_mutual_friends:user %}
                    <span>{{ friend.get_full_name }}</span>
                {% endfor %}
            </div>
        </div>
{% endif %}
{% if current_user|has_friend:user %}
    <a href='javascript:;' class="link-remove-friend {user: {{ user.id }}}">- Remove</a>
{% elif current_user|has_friend_request:user %}
        Friend request pending.
{% elif user|in_followers:current_user %}
    {% if user|check_friend_request:current_user %}    
    <a href='javascript:;' class="link-add-friend {user: {{ user.id }}}">+ Add</a>
    {% endif %}
    <a href=javascript:;' class="link-unfollow { user: '{{ user.id }}' }" style="margin-left: 10px; cursor: pointer;" >- Unfollow</a>
{% else %}
    {% if user|check_friend_request:current_user %}
    <a href='javascript:;' class="link-add-friend {user: {{ user.id }}}">+ Add</a>
    {% endif %}
    {% if user|check_following:current_user %}    
    <a href=javascript:;' class="link-follow { user: '{{ user.id }}' }" style="margin-left: 10px; cursor: pointer;" >+ Follow</a>
    {% endif %}
{% endif %}

<div class="DoS" onMouseOver="ShowContent('{{ user.username }}'); return false;" onMouseOut="HideContent('{{ user.username }}'); return false;">
<table width="150" height="100%"><tr><td align="right">
Degree of Separation:<br />
{% if current_user|has_friend:user %}
This is your friend!
{% else %}
<div class="lf_ref" id="{{ user.username }}">
<table width="170" height="100%"><tr><td><span style="font-weight: bold;">Not enough connections?</span><br /> Try inviting more people to Lionface or adding more friends. It will work.</td></tr></table>
</div>
{% endif %}
</td>
{% if current_user|degree_of_separation:user or current_user|degree_of_separation:user == 0  %}
<td align="left" title="{{ current_user|degree_of_separation:user }}" style="font-size: 16pt;">{{ current_user|degree_of_separation:user }}</td>
{% else %}
<td align="left" title="Unknown" style="font-size: 16pt;">--</td>
{% endif %}
</tr></table></div>
</span>
</td></tr></table>
